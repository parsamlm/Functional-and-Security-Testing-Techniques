import org.jsoup.Jsoup
import java.sql.Connection
import java.sql.DriverManager

private fun getWebsiteContent(url: String): String = runCatching { HttpRequestExecutor().run(url) }.getOrDefault("")

fun getWordPressVersion(url: String?): Map<String, String?> {
    val content = Jsoup.parse(getWebsiteContent(url ?: return mapOf("version" to null)))
        .select("meta[name=generator]").first()?.attr("content")
    return mapOf("version" to content?.split(" ")?.get(1))
}

var connection: Connection? = null

fun connectToMySQLDatabase(
    url: String = "jdbc:mysql://localhost:3306/",
    username: String = "root",
    password: String = ""
) {
    connection = DriverManager.getConnection(url, username, password)
}

fun disconnectFromMySQLDatabase() = connection?.close()

fun getMySQLVersion(): String {
    connectToMySQLDatabase()
    val version = connection?.createStatement()?.executeQuery("SELECT VERSION()")?.run {
        next()
        getString(1)
    } ?: ""
    disconnectFromMySQLDatabase()
    return version.split("-")[0]
}

fun getApacheVersion(): String =
    runBashCommand(arrayOf("httpd", "-v")).split("\n")[0].split(":")[1].split("/")[1].split(" ")[0]

enum class ServiceType {
    WORDPRESS,
    APACHE,
    MYSQL
}