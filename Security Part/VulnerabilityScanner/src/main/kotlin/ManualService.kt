import org.jsoup.Jsoup
import java.sql.Connection
import java.sql.DriverManager
import java.sql.SQLException

private fun getWebsiteContent(url: String): String {
    var htmlDocument = ""
    try {
        htmlDocument = HttpRequestExecutor().run(
            url = url,
        )
    } catch (exception: Exception) {
        return htmlDocument
    }
    return htmlDocument
}

fun getWordPressVersion(url: String?): Map<String, String?> {
    if (url != null) {
        val htmlDocument = getWebsiteContent(url)
        if (htmlDocument.isNotEmpty()) {
            val doc = Jsoup.parse(htmlDocument)
            val metaTag = doc.select("meta[name=generator]").first()
            if (metaTag != null) {
                val content = metaTag.attr("content")
                if (content.contains("WordPress")) {
                    return mapOf("version" to content.split(" ")[1])
                }
            }
        }
    }
    return mapOf("version" to null)
}

var connection: Connection? = null
fun connectToMySQLDatabase(
    url: String = "jdbc:mysql://localhost:3306/",
    username: String = "root",
    password: String = ""
) {
    try {
        connection = DriverManager.getConnection(url, username, password)
    } catch (e: SQLException) {
        println("Cannot connect to the MySQL database.")
        e.printStackTrace()
    }
}

fun disconnectFromMySQLDatabase() {
    connection?.close()
}

fun getMySQLVersion(): String {
    connectToMySQLDatabase()
    val statement = connection?.createStatement()
    val resultSet = statement?.executeQuery("SELECT VERSION()")
    resultSet?.next()
    val version = resultSet?.getString(1) ?: ""
    disconnectFromMySQLDatabase()
    return version.split("-")[0]
}


enum class ServiceType {
    WORDPRESS,
    APACHE,
    MYSQL,
    NONE
}