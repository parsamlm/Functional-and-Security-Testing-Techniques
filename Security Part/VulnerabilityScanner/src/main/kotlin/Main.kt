fun main() {

    val process = Runtime.getRuntime().exec(arrayOf("bash", "-c", "docker ps"))
    val errorStream = process.errorStream
    val outputStream = process.inputStream

    val exitCode = process.waitFor()

    fun isSuccess(): Boolean {
        // Check exit code (0 indicates successful execution)
        return exitCode == 0
    }

    fun isDockerRunning(): Boolean {
        // Check for errors in the error stream (empty if successful)
        if (errorStream.read() != -1) {
            return false
        }

        // Check for any output in the output stream (indicates at least one container)
        return outputStream.read() != -1
    }

    if (isSuccess()) {
        if (isDockerRunning()) {
            // Start Docker containers
            runBashCommand(
                arrayOf(
                    "/bin/bash",
                    "-c",
                    "docker start \$(docker ps -aq --filter name=wordpress-docker-*)"
                )
            )

            val serviceDetailsList = getServiceDetailsFromNetwork("wordpress-docker_my-network")
            writeToFile(
                "/Users/parsa/IdeaProjects/Functional-and-Security-Testing-Techniques/Security Part/VulnerabilityScanner/src/main/resources/network_services.json",
                kotlinObjectToJson(serviceDetailsList)
            )
            serviceDetailsList.forEach { serviceDetails ->
                val vulnerabilities = fetchAllVulnerabilities(
                    serviceDetails.serviceVendor,
                    serviceDetails.serviceType!!,
                    serviceDetails.serviceVersion
                )
                println("${serviceDetails.serviceType} (version: ${serviceDetails.serviceVersion}) vulnerabilities (CVE IDs List):")
                vulnerabilities.forEach { vulnerability ->
                    println(vulnerability.cve.id)
                }
                println("---------------------------------------------------")
            }

            // Stop Docker containers
            runBashCommand(arrayOf("/bin/bash", "-c", "docker stop \$(docker ps -aq --filter name=wordpress-docker-*)"))
        }
    } else {
        println("Docker daemon is not running. Please start Docker daemon and try again.")
    }
}